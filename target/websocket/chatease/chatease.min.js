chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="0.1.10";chatease.debug=!1;
(function(d){function f(a){return null!==navigator.userAgent.toLowerCase().match(a)}var e=d.utils={};e.exists=function(a){switch(e.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};e.extend=function(){var a=Array.prototype.slice.call(arguments,0),b=a[0];if(1<a.length)for(var g=1;g<a.length;g++)e.foreach(a[g],function(a,g){void 0!==g&&null!==g&&(b[a]=g)});return b};e.foreach=function(a,b){for(var g in a)a.hasOwnProperty&&"function"===e.typeOf(a.hasOwnProperty)?
a.hasOwnProperty(g)&&b(g,a[g]):b(g,a[g])};e.getCookie=function(a){var b;return(b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(b[2]):null};e.createElement=function(a,b){var g=document.createElement(a);b&&(g.className=b);return g};e.addClass=function(a,b){var g="string"===e.typeOf(a.className)?a.className.split(" "):[],c="array"===e.typeOf(b)?b:b.split(" ");e.foreach(c,function(a,b){-1===e.indexOf(g,b)&&g.push(b)});a.className=e.trim(g.join(" "))};e.removeClass=function(a,
b){var g="string"===e.typeOf(a.className)?a.className.split(" "):[],c="array"===e.typeOf(b)?b:b.split(" ");e.foreach(c,function(a,b){var c=e.indexOf(g,b);0<=c&&g.splice(c,1)});a.className=e.trim(g.join(" "))};e.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};e.typeOf=function(a){if(null===a||void 0===a)return"null";var b=typeof a;if("object"===b)try{if("[object Array]"===toString.call(a))return"array"}catch(g){}return b};e.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};
e.indexOf=function(a,b){if(null==a)return-1;for(var g=0;g<a.length;g++)if(a[g]===b)return g;return-1};e.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),f(new RegExp("msie\\s*"+a,"i"))):f(/msie/i)};var c=window.console=window.console||{log:function(){}};e.log=function(){var a=Array.prototype.slice.call(arguments,0);"object"===e.typeOf(c.log)?c.log(a):c.log.apply(c,a)}})(chatease);
(function(d){function f(){var a=document.createElement("style");a.type="text/css";document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet}var e=d.utils,c;(e.css=function(a,b){c||(c=f());var g="";e.foreach(b,function(a,b){g+=a+": "+b+"; "});try{c.insertRule?c.insertRule(a+" { "+g+"}",c.cssRules.length):c.addRule(a,g,c.rules.length)}catch(h){e.log("Failed to insert css rule: "+a)}}).style=function(a,b,g){if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),b=e.extend({},
b),g=0;g<a.length;g++){var c=a[g];void 0!==c&&null!==c&&e.foreach(b,function(a,b){var g;g=a.split("-");for(var e=1;e<g.length;e++)g[e]=g[e].charAt(0).toUpperCase()+g[e].slice(1);g=g.join("");c.style[g]!==b&&(c.style[g]=b)})}}})(chatease);
(function(d){d.events={ERROR:"ERROR",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_ERROR:"chateaseError",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_SHIELDMSG:"chateaseViewMsgShield",CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",
CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(d){var f=d.utils;d.events.eventdispatcher=function(e){function c(a,b,e){if(a)for(var c=0;c<a.length;c++){var d=a[c];if(d){null!==d.count&&0===--d.count&&delete a[c];try{d.listener(b)}catch(p){f.log('Error handling "'+e+'" event listener ['+c+"]: "+p.toString(),d.listener,b)}}}}var a={},b=[];this.addEventListener=function(b,c,e){try{f.exists(a[b])||(a[b]=[]),"string"===f.typeOf(c)&&(c=(new Function("return "+c))()),a[b].push({listener:c,count:e||null})}catch(d){f.log("error",d)}return!1};
this.removeEventListener=function(b,c){if(a[b]){try{if(void 0===c){a[b]=[];return}var e;for(e=0;e<a[b].length;e++)if(a[b][e].listener.toString()===c.toString()){a[b].splice(e,1);break}}catch(d){f.log("error",d)}return!1}};this.addGlobalListener=function(a,c){try{"string"===f.typeOf(a)&&(a=(new Function("return "+a))()),b.push({listener:a,count:c||null})}catch(e){f.log("error",e)}return!1};this.removeGlobalListener=function(a){if(a){try{var c;for(c=b.length-1;0<=c;c--)b[c].listener.toString()===a.toString()&&
b.splice(c,1)}catch(e){f.log("error",e)}return!1}};this.dispatchEvent=function(g,h){h||(h={});f.extend(h,{id:e,version:d.version,type:g});d.debug&&f.log(g,h);c(a[g],h,g);c(b,h,g)}}})(chatease);
(function(d){var f=d.utils,e=d.events,c={},a={onError:e.ERROR,onReady:e.CHATEASE_READY,onConnect:e.CHATEASE_CONNECT,onIdent:e.CHATEASE_INDENT,onMessage:e.CHATEASE_MESSAGE,onJoin:e.CHATEASE_JOIN,onLeft:e.CHATEASE_LEFT,onNickClick:e.CHATEASE_VIEW_NICKCLICK,onClose:e.CHATEASE_CLOSE};d.api=function(b){function c(a){h.dispatchEvent(a.type,a)}var h=f.extend(this,new e.eventdispatcher("api")),m;h.container=b;h.id=b.id;h.setup=function(a){f.emptyElement(h.container);h.config=a;h.embedder=new d.embed(h);h.embedder.addGlobalListener(c);
h.embedder.embed();return h};h.setEntity=function(a,b){m=a;h.renderMode=b;h.send=m.send;h.resize=m.resize};(function(){f.foreach(a,function(a,b){h[a]=function(a){h.addEventListener(b,a)}})})()};d.api.getInstance=function(a){var e;null==a?a=0:a.nodeType?e=a:"string"===f.typeOf(a)&&(e=document.getElementById(a));if(e){var h=c[e.id];h||(c[a]=h=new d.api(e));return h}return"number"===f.typeOf(a)?c[a]:null};d.api.displayError=function(a,c){}})(chatease);(function(d){d.core={}})(chatease);
(function(d){d.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);(function(d){d.core.renders={}})(chatease);(function(d){d.core.renders.modes={DEFAULT:"def"}})(chatease);(function(d){d.core.renders.skins={}})(chatease);
(function(d){var f=d.utils,e=d.events,c=f.css;d.core.renders.skins.def=function(a){var b=f.extend(this,new e.eventdispatcher("skins.def"));c(".chatwrap",{width:a.width+"px",height:a.height+"px","box-shadow":"0 1px 1px rgba(0, 0, 0, 0.05)"});c(".chatwrap *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});c(".render",{width:a.width-2+"px",height:a.height-2+"px",border:"1px solid #1184ce","border-radius":"4px",
position:"relative"});c(" .title",{padding:"auto 12px",width:"100%",height:"34px","font-family":"inherit","font-weight":"normal",color:"#fff","text-align":"center","line-height":"34px","vertical-align":"middle","box-shadow":"none","background-color":"#1184ce",cursor:"not-allowed","pointer-events":"none"});c(" .title span",{top:"2px","margin-left":"2px"});c(" .main",{width:"100%",height:a.height-2-parseInt("34px")+"px"});c(" .main .console",{width:"100%",height:.75*(a.height-parseInt("34px"))+"px",
"max-height":"75%","overflow-y":"auto","background-color":"#f8f8f8"});c(" .main .console > div",{margin:"5px","word-break":"break-all","word-wrap":"break-word"});c(" .main .console > div > span",{"margin-right":"5px"});c(" .main .console > div > span.vip1",{});c(" .main .console > div > span.vip2",{});c(" .main .console > div > span.vip3",{});c(" .main .console > div > span.vip4",{});c(" .main .console > div > span.vip5",{});c(" .main .console > div > span.vip6",{});c(" .main .console > div > span.vip7",
{});c(" .main .console > div > span.temporary",{});c(" .main .console > div > span.manager",{});c(" .main .console > div > span.owner",{});c(" .main .console > div > span.system",{});c(" .main .console > div > span.admin",{});c(" .main .console > div > a",{"margin-right":"5px",color:"#1184ce","text-decoration":"none",cursor:"pointer"});c(" .main .console > div.system > a",{"font-style":"normal","font-weight":"bold",color:"red"});c(" .main .console > div.myself",{});c(" .main .console > div.myself > a",
{});c(" .main .dialog",{width:"100%",height:.25*(a.height-1-parseInt("34px"))+"px",position:"relative",overflow:"hidden"});c(" .main .dialog .control",{width:"100%",height:"38px",border:"1px solid #1184ce","border-width":"1px 0"});c(" .main .dialog .control > *",{margin:"0 5px",height:"100%","line-height":"38px","text-align":"center","vertical-align":"middle","box-sizing":"border-box",display:"inline-block"});c(" .main .dialog .control > div > .ch",{color:"#666","vertical-align":"middle",cursor:"pointer"});
c(" .main .dialog .control > div > .ch input[type=checkbox]",{"margin-right":"5px",cursor:"pointer"});c(" .main .dialog .control > div > .ch a",{});c(" .main .dialog .control > div > .btn",{padding:"3px 5px",color:"#fff","text-align":"center","vertical-align":"middle","border-radius":"3px","background-color":"#1184ce",cursor:"pointer"});c(" .main .dialog .control .msgshield",{"float":"left"});c(" .main .dialog .control .clrscreen",{"float":"right"});c(" .main .dialog .control .clrscreen span",{top:"2px",
"margin-left":"2px"});c(" .main .dialog .input",{position:"relative"});c(" .main .dialog .input textarea",{"float":"left",margin:"0",padding:"5px 10px",width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",resize:"none",border:"0 none","border-radius":"0 0 0 4px","box-sizing":"border-box",overflow:"auto"});c(" .main .dialog .input button",{"float":"left",padding:0,width:"46px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",color:"#fff",
border:"0 none","box-sizing":"border-box","background-color":"#1184ce",cursor:"pointer"});f.isMSIE(7)&&(c(" .main .dialog .input textarea",{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),c(" .main .dialog .input button",{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}));b.resize=function(b,e){f.log("Resizing to "+b+", "+e);a.width=parseInt(b);a.height=parseInt(e);var d=document.getElementById(a.id),l=document.getElementById(a.prefix+
"render"),q=document.getElementById(a.prefix+"main"),p=document.getElementById(a.prefix+"console"),v=document.getElementById(a.prefix+"dialog"),n=document.getElementById(a.prefix+"input"),u=document.getElementById(a.prefix+"submit");c.style(d,{width:a.width+"px",height:a.height+"px"});c.style(l,{width:a.width-2+"px",height:a.height-2+"px"});c.style(q,{height:a.height-2-parseInt("34px")+"px"});c.style(p,{height:.75*(a.height-parseInt("34px"))+"px"});c.style(v,{height:.25*(a.height-1-parseInt("34px"))+
"px"});c.style(n,{width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});c.style(u,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});f.isMSIE(7)&&(c.style(n,{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),c.style(u,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}))}}})(chatease);
(function(d){var f=d.utils,e=d.events;d=d.core.renders;var c=d.skins;d.def=function(a,b){function g(a){var b="";switch(f.typeOf(a)){case "string":if(a=parseInt(a),NaN==a||0>a)break;case "number":a&128?b="admin":a&64||(a&32?b="owner":a&16?b="manager":a&8&&(b="temporary")),a&7&&(b+=(b.length?" ":"")+"vip"+(a&7))}return b}function d(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?k.value+="\r\n":(l.send(),window.event?window.event.returnValue=!1:a.preventDefault()))}function m(a){l.send()}var l=f.extend(this,
new e.eventdispatcher("renders.def")),q,p,v,n,u,r,t,k,w;l.show=function(b,c){var d=f.createElement("div"),t;switch(f.typeOf(b)){case "object":t=b.text;if("uni"==b.type){var k=f.createElement("span");k.innerHTML="[\u5bc6\u8bed]";d.appendChild(k)}break;default:t=b}switch(f.typeOf(c)){case "string":if(""===c)break;c={id:0,name:c,role:0};case "null":c={id:0,name:"[\u7cfb\u7edf]",role:64};case "object":if(null==f.typeOf(c.id))break;if(k=0<=c.role&&c.role&64?"system":c.id==a.user().id?"myself":"")d.className=
k;if(k=g(c.role)){var h=f.createElement("span",k);h.innerHTML=k.substr(0,1);d.appendChild(h)}k=f.createElement("a");k.user=f.extend({},c);k.innerHTML=c.name;try{k.addEventListener("click",function(a){l.dispatchEvent(e.CHATEASE_VIEW_NICKCLICK,{user:this.user})})}catch(p){k.attachEvent("onclick",function(a){l.dispatchEvent(e.CHATEASE_VIEW_NICKCLICK,{user:this.user})})}d.appendChild(k)}d.insertAdjacentHTML("beforeend",t);n.childNodes.length>=l.config.maxlog&&n.removeChild(n.childNodes[0]);n.appendChild(d);
n.scrollTop=n.scrollHeight};l.send=function(){l.dispatchEvent(e.CHATEASE_VIEW_SEND,{message:k.value,userId:null});l.clearInput()};l.clearInput=function(){k.value=""};l.clearScreen=function(){f.emptyElement(n)};l.element=function(){return q};l.resize=function(a,c){a=a||q.offsetWidth||b.width;c=c||q.offsetHeight||b.height;w&&w.resize(a,c)};l.destroy=function(){};l.config=f.extend({},{skin:"def",prefix:"chat-"},b);q=f.createElement("div","render");p=f.createElement("div","title");v=f.createElement("div",
"main");q.appendChild(p);q.appendChild(v);n=f.createElement("div","console");u=f.createElement("div","dialog");v.appendChild(n);v.appendChild(u);r=f.createElement("div","control");t=f.createElement("div","input");u.appendChild(r);u.appendChild(t);p.innerHTML="\u804a\u5929\u5ba4";(function(a,c,b,e,d){a=f.createElement("div",a);var g=f.createElement("label","ch"),k=f.createElement("input");k.type="checkbox";k.checked=!!d;try{k.addEventListener("change",function(a){l.dispatchEvent(c,f.extend({shield:k.checked},
b))})}catch(t){k.attachEvent("onchange",function(a){l.dispatchEvent(c,f.extend({shield:k.checked},b))})}g.appendChild(k);d=f.createElement("a");d.innerHTML=e;g.appendChild(d);a.appendChild(g);r.appendChild(a)})("msgshield",e.CHATEASE_VIEW_SHIELDMSG,null,"\u5c4f\u853d\u6d88\u606f",!1);(function(a,c,b,e,d){a=f.createElement("div",a);d=f.createElement("a","btn");d.innerHTML=e;try{d.addEventListener("click",function(a){l.dispatchEvent(c,b)})}catch(g){d.attachEvent("onclick",function(a){l.dispatchEvent(c,
b)})}a.appendChild(d);r.appendChild(a)})("clrscreen",e.CHATEASE_VIEW_CLEARSCREEN,null,"\u6e05\u5c4f","glyphicon glyphicon-trash");k=f.createElement("textarea");k.setAttribute("placeholder","\u8f93\u5165\u804a\u5929\u5185\u5bb9");k.setAttribute("maxlength",30);try{k.addEventListener("keypress",d)}catch(x){k.attachEvent("onkeypress",d)}t.appendChild(k);p=f.createElement("button");p.innerHTML="\u53d1\u9001";try{p.addEventListener("click",m)}catch(x){p.attachEvent("onclick",m)}t.appendChild(p);q.id=l.config.prefix+
"render";v.id=l.config.prefix+"main";n.id=l.config.prefix+"console";u.id=l.config.prefix+"dialog";k.id=l.config.prefix+"input";p.id=l.config.prefix+"submit";try{w=new c[l.config.skin](l.config)}catch(x){f.log("Failed to init skin["+l.config.skin+"].")}w||l.dispatchEvent(e.CHATEASE_RENDER_ERROR,{message:"No suitable skin found!",skin:l.config.skin})}})(chatease);
(function(d){var f=d.utils,e=d.events,c=d.core;c.entity=function(a){var b=f.extend(this,new e.eventdispatcher("core.entity")),d,h,m;b.setup=function(){h.setup()};b.destroy=function(){m&&m.stop();h&&h.destroy();d&&d.destroy()};b.id=a.id;b.model=d=new c.model(a);b.view=h=new c.view(b,d);b.controller=m=new c.controller(d,h);m.addGlobalListener(function(a){b.dispatchEvent(a.type,a)});b.send=m.send;b.resize=h.resize}})(chatease);
(function(d){var f=d.utils,e=d.events;d=d.core;var c=d.states;d.model=function(a){var b=f.extend(this,new e.eventdispatcher("core.model"));b.setState=function(a){a!==b.state&&(b.state=a,b.dispatchEvent(e.CHATEASE_STATE,{state:a}))};b.setMsgShield=function(a){a!==b.shieldMsg&&(b.shieldMsg=a,b.dispatchEvent(e.CHATEASE_VIEW_SHIELDMSG,{shield:a}))};b.getConfig=function(a){return b.config[a]||{}};b.destroy=function(){};b.config=f.extend({},{},a);f.extend(b,{id:a.id,user:{id:NaN,name:"",role:-1},state:c.CLOSED,
shieldMsg:!1},b.config)}})(chatease);
(function(d){var f=d.utils,e=d.events;d=d.core;var c=d.renders,a=c.modes;d.view=function(b,d){function h(){switch(d.renderMode){case a.DEFAULT:var b=f.extend(d.getConfig("render"),{id:d.id,width:d.width,height:d.height,maxlog:d.maxlog});r.render=k=new c[a.DEFAULT](r,b);break;default:r.dispatchEvent(e.CHATEASE_SETUP_ERROR,{message:"Unknown render mode!",render:d.renderMode})}k&&(k.addEventListener(e.CHATEASE_VIEW_SEND,m),k.addEventListener(e.CHATEASE_VIEW_SHIELDMSG,l),k.addEventListener(e.CHATEASE_VIEW_CLEARSCREEN,
q),k.addEventListener(e.CHATEASE_VIEW_NICKCLICK,p),k.addEventListener(e.CHATEASE_RENDER_ERROR,v),t.appendChild(k.element()))}function m(a){n(a)}function l(a){n(a)}function q(a){n(a)}function p(a){n(a)}function v(a){n(a)}function n(a){r.dispatchEvent(a.type,a)}function u(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:k.send()}if(/13/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}var r=f.extend(this,new e.eventdispatcher("core.view")),t,k;r.setup=function(){h();
try{t.addEventListener("keydown",u)}catch(a){t.attachEvent("onkeydown",u)}setTimeout(function(){r.dispatchEvent(e.CHATEASE_READY,{channelId:b.id})},0)};r.show=function(a,b){d.shieldMsg||k&&k.show(a,b)};r.user=function(){return d.user};r.resize=function(a,b){k&&k.resize(a,b)};r.destroy=function(){t&&t.removeEventListener("keydown",u);k&&k.destroy()};(function(){t=f.createElement("div","chatwrap");t.id=b.id;t.tabIndex=0;var a=document.getElementById(b.id);a.parentNode.replaceChild(t,a);window.onresize=
function(){"function"==f.typeOf(d.onresize)?d.onresize.call(null):r.resize()}})()}})(chatease);
(function(d){var f=d.utils,e=d.events;d=d.core;var c=d.states;d.controller=function(a,b){function d(){if(!n){try{n=window.WebSocket?new WebSocket(a.url+"?token="+f.getCookie("token")):window.MozWebSocket?new MozWebSocket(a.url+"?token="+f.getCookie("token")):new SockJS(a.url.replace(/^ws/,"http")+"/sockjs")}catch(t){f.log("Failed to initialize websocket.");return}n.onopen=function(b){a.setState(c.CONNECTED)};n.onmessage=function(c){var d;try{d=eval("("+c.data+")")}catch(g){f.log("Eval failed. \nerr: "+
g+"\ndata: "+c.data);return}switch(d.raw){case "ident":f.foreach(d.user,function(b,c){a.user.hasOwnProperty(b)&&(a.user[b]=c)});a.messageInterval=d.user.interval;p.dispatchEvent(e.CHATEASE_INDENT,d);break;case "message":b.show(d.data,d.user);p.dispatchEvent(e.CHATEASE_MESSAGE,d);break;case "join":b.show(m(d.user.role)+" "+d.user.name+" \u8fdb\u5165\u804a\u5929\u5ba4\u3002");p.dispatchEvent(e.CHATEASE_JOIN,d);break;case "left":b.show(m(d.user.role)+" "+d.user.name+" \u5df2\u79bb\u5f00\u3002");p.dispatchEvent(e.CHATEASE_LEFT,
d);break;case "error":(c=h(d))&&b.show(c);p.dispatchEvent(e.CHATEASE_ERROR,d);break;default:f.log("Unknown data type, ignored.")}};n.onerror=function(b){a.setState(c.ERROR)};n.onclose=function(b){a.setState(c.CLOSED)}}}function h(a){var b;switch(a.data.code){case 400:b="\u9519\u8bef\u8bf7\u6c42\uff01";break;case 401:b="\u8bf7\u5148\u767b\u5f55\uff01";break;case 403:b="\u6743\u9650\u9519\u8bef\uff01";break;case 404:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case 409:b="\u64cd\u4f5c\u9891\u7e41\uff01"}return b}
function m(a){var b="";switch(f.typeOf(a)){case "string":if(a=parseInt(a),NaN==a||0>a)break;case "number":a&192?b="\u8d85\u7ba1":a&32?b="\u4e3b\u64ad":a&24?b="\u623f\u7ba1":a&7&&(b="VIP"+(a&7))}return b}function l(){if(!a.maxRetries||r<a.maxRetries){var c=Math.ceil(a.retryDelay+5E3*Math.random());b.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde("+c/1E3+"\u79d2)...");setTimeout(function(){r++;n=null;d()},c)}}function q(a){p.dispatchEvent(a.type,a)}var p=f.extend(this,new e.eventdispatcher("core.controller")),
v=!1,n,u=0,r=0;p.send=function(b,e){n&&a.state!=c.CLOSED?n.send(b.substr(0,30)):d()};p.close=function(){n&&n.close()};a.addEventListener(e.CHATEASE_STATE,function(d){switch(d.state){case c.CONNECTED:b.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u3002");r=0;p.dispatchEvent(e.CHATEASE_CONNECT,{channelId:a.id});break;case c.CLOSED:b.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");p.dispatchEvent(e.CHATEASE_CLOSE,{channelId:a.id});l();break;case c.ERROR:b.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");
p.dispatchEvent(e.CHATEASE_ERROR,{message:"Chat room error!",channelId:a.id});break;default:p.dispatchEvent(e.CHATEASE_ERROR,{message:"Unknown model state!",state:d.state})}});a.addEventListener(e.CHATEASE_VIEW_SHIELDMSG,function(a){q(a)});b.addEventListener(e.CHATEASE_READY,function(b){v||(q(b),v=!0,d(),window.onbeforeunload=function(b){n&&a.state==c.CONNECTED&&n.close()})});b.addEventListener(e.CHATEASE_VIEW_SEND,function(c){if(c&&c.message){var d=(new Date).getTime();0<=a.messageInterval&&d-u<
a.messageInterval?b.show("\u64cd\u4f5c\u9891\u7e41\uff01"):(u=d,p.send(c.message,c.userId))}else b.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});b.addEventListener(e.CHATEASE_VIEW_SHIELDMSG,function(b){a.setMsgShield(b.shield)});b.addEventListener(e.CHATEASE_VIEW_CLEARSCREEN,function(a){b.render.clearScreen();q(a)});b.addEventListener(e.CHATEASE_VIEW_NICKCLICK,function(a){q(a)});b.addEventListener(e.CHATEASE_SETUP_ERROR,function(a){q(a)});b.addEventListener(e.CHATEASE_RENDER_ERROR,function(a){q(a)})}})(chatease);
(function(d){var f=d.utils,e=d.events,c=d.core.renders.modes,a=d.embed=function(b){function g(a){switch(a.type){case e.ERROR:case e.CHATEASE_SETUP_ERROR:case e.CHATEASE_RENDER_ERROR:case e.CHATEASE_ERROR:h.errorScreen(a.message);h.dispatchEvent(e.ERROR,a);break;default:h.dispatchEvent(a.type,a)}}var h=f.extend(this,new e.eventdispatcher("embed")),m=new a.config(b.config),l=!1,q=null;m.id=b.id;h.embed=function(){try{q=new a[m.renderMode](b,m)}catch(d){f.log("Render ["+m.renderMode+"] not found.")}if(!q||
!q.supports())if(m.fallback)m.renderMode=m.renderMode=c.DEFAULT,q=new a.def(b,m);else{h.dispatchEvent(e.CHATEASE_SETUP_ERROR,{message:"No suitable render found!",render:m.renderMode,fallback:m.fallback});return}q.addGlobalListener(g);q.embed()};h.errorScreen=function(a){l||(l=!0,d.api.displayError(a,m))};(function(){f.foreach(m.events,function(a,c){var d=b[a];"function"===f.typeOf(d)&&d.call(b,c)})})()}})(chatease);
(function(d){var f=d.utils,e=d.embed,c=d.core.renders.modes;e.config=function(a){return f.extend({},{url:"ws://"+window.location.host+"/websocket/websck",width:300,height:450,renderMode:c.DEFAULT,retryDelay:3E3,maxRetries:0,messageInterval:0,maxlog:50,fallback:!0},a)};e.config.addConfig=function(a,b){return f.extend(a,b)}})(chatease);
(function(d){var f=d.utils,e=d.events,c=d.core,a=c.renders.modes;d.embed.def=function(b,d){function h(a){m.dispatchEvent(a.type,a)}var m=f.extend(this,new e.eventdispatcher("embed.def"));m.renderMode=a.DEFAULT;m.embed=function(){var a=new c.entity(d);a.addGlobalListener(h);a.setup();b.setEntity(a,d.renderMode)};m.supports=function(){return!0}}})(chatease);