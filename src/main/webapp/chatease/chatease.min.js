chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="0.1.22";
(function(f){function g(a){return null!==navigator.userAgent.toLowerCase().match(a)}var e=f.utils={};e.exists=function(a){switch(e.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};e.extend=function(){var a=Array.prototype.slice.call(arguments,0),d=a[0];if(1<a.length)for(var c=1;c<a.length;c++)e.foreach(a[c],function(a,c){void 0!==c&&null!==c&&(d[a]=c)});return d};e.foreach=function(a,d){for(var c in a)a.hasOwnProperty&&"function"===e.typeOf(a.hasOwnProperty)?
a.hasOwnProperty(c)&&d(c,a[c]):d(c,a[c])};e.getCookie=function(a){var d;return(d=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(d[2]):null};e.formatTime=function(a){var d=a.getHours()+1,c=a.getMinutes(),b=a.getSeconds();return a.toLocaleDateString()+" "+e.pad(d,2)+":"+e.pad(c,2)+":"+e.pad(b,2)};e.pad=function(a,d){for(var c=a+"";c.length<d;)c="0"+c;return c};e.createElement=function(a,d){var c=document.createElement(a);d&&(c.className=d);return c};e.addClass=function(a,d){var c=
"string"===e.typeOf(a.className)?a.className.split(" "):[],b="array"===e.typeOf(d)?d:d.split(" ");e.foreach(b,function(a,d){-1===e.indexOf(c,d)&&c.push(d)});a.className=e.trim(c.join(" "))};e.removeClass=function(a,d){var c="string"===e.typeOf(a.className)?a.className.split(" "):[],b="array"===e.typeOf(d)?d:d.split(" ");e.foreach(b,function(a,d){var b=e.indexOf(c,d);0<=b&&c.splice(b,1)});a.className=e.trim(c.join(" "))};e.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};e.typeOf=
function(a){if(null===a||void 0===a)return"null";var d=typeof a;if("object"===d)try{if("[object Array]"===toString.call(a))return"array"}catch(c){}return d};e.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};e.indexOf=function(a,d){if(null==a)return-1;for(var c=0;c<a.length;c++)if(a[c]===d)return c;return-1};e.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),g(new RegExp("msie\\s*"+a,"i"))):g(/msie/i)};var b=window.console=window.console||{log:function(){}};e.log=function(){var a=Array.prototype.slice.call(arguments,
0);"object"===e.typeOf(b.log)?b.log(a):b.log.apply(b,a)}})(chatease);
(function(f){function g(){var a=document.createElement("style");a.type="text/css";document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet}var e=f.utils,b;(e.css=function(a,d){b||(b=g());var c="";e.foreach(d,function(a,d){c+=a+": "+d+"; "});try{b.insertRule?b.insertRule(a+" { "+c+"}",b.cssRules.length):b.addRule(a,c,b.rules.length)}catch(x){e.log("Failed to insert css rule: "+a)}}).style=function(a,d,c){if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),d=e.extend({},
d),c=0;c<a.length;c++){var b=a[c];void 0!==b&&null!==b&&e.foreach(d,function(a,c){var d;d=a.split("-");for(var e=1;e<d.length;e++)d[e]=d[e].charAt(0).toUpperCase()+d[e].slice(1);d=d.join("");b.style[d]!==c&&(b.style[d]=c)})}}})(chatease);(function(f){var g=f.utils;g.filter=function(e){var b,a="";this.replace=function(d){return a&&b?d.replace(b,"**"):d};"string"==g.typeOf(e)&&e&&(a=e,b=new RegExp(a,"ig"))}})(chatease);
(function(f){f.events={ERROR:"ERROR",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_ERROR:"chateaseError",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_SHIELDMSG:"chateaseViewMsgShield",CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",
CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(f){var g=f.utils;f.events.eventdispatcher=function(e){function b(a,d,e){if(a)for(var b=0;b<a.length;b++){var f=a[b];if(f){null!==f.count&&0===--f.count&&delete a[b];try{f.listener(d)}catch(w){g.log('Error handling "'+e+'" event listener ['+b+"]: "+w.toString(),f.listener,d)}}}}var a={},d=[];this.addEventListener=function(c,d,b){try{g.exists(a[c])||(a[c]=[]),"string"===g.typeOf(d)&&(d=(new Function("return "+d))()),a[c].push({listener:d,count:b||null})}catch(e){g.log("error",e)}return!1};
this.removeEventListener=function(c,d){if(a[c]){try{if(void 0===d){a[c]=[];return}var b;for(b=0;b<a[c].length;b++)if(a[c][b].listener.toString()===d.toString()){a[c].splice(b,1);break}}catch(e){g.log("error",e)}return!1}};this.addGlobalListener=function(a,b){try{"string"===g.typeOf(a)&&(a=(new Function("return "+a))()),d.push({listener:a,count:b||null})}catch(e){g.log("error",e)}return!1};this.removeGlobalListener=function(a){if(a){try{var b;for(b=d.length-1;0<=b;b--)d[b].listener.toString()===a.toString()&&
d.splice(b,1)}catch(e){g.log("error",e)}return!1}};this.dispatchEvent=function(c,x){x||(x={});g.extend(x,{id:e,version:f.version,type:c});f.debug&&g.log(c,x);b(a[c],x,c);b(d,x,c)}}})(chatease);
(function(f){var g=f.utils,e=f.events,b={},a={onError:e.ERROR,onReady:e.CHATEASE_READY,onConnect:e.CHATEASE_CONNECT,onIdent:e.CHATEASE_INDENT,onMessage:e.CHATEASE_MESSAGE,onJoin:e.CHATEASE_JOIN,onLeft:e.CHATEASE_LEFT,onNickClick:e.CHATEASE_VIEW_NICKCLICK,onClose:e.CHATEASE_CLOSE};f.api=function(d){function c(a){b.dispatchEvent(a.type,a)}var b=g.extend(this,new e.eventdispatcher("api")),n;b.container=d;b.id=d.id;b.setup=function(a){g.emptyElement(b.container);f.debug=!!a.debug;b.config=a;b.config.id=
b.id;b.embedder=new f.embed(b);b.embedder.addGlobalListener(c);b.embedder.embed();return b};b.setEntity=function(a,d){n=a;b.renderName=d;b.send=n.send;b.join=n.join;b.resize=n.resize};(function(){g.foreach(a,function(a,d){b[a]=function(a){b.addEventListener(d,a)}})})()};f.api.getInstance=function(a){var c;null==a?a=0:a.nodeType?c=a:"string"===g.typeOf(a)&&(c=document.getElementById(a));if(c){var e=b[c.id];e||(b[a]=e=new f.api(c));return e}return"number"===g.typeOf(a)?b[a]:null};f.api.displayError=
function(a,b){}})(chatease);(function(f){f.core={}})(chatease);(function(f){f.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);(function(f){f.core.renders={}})(chatease);(function(f){f.core.renders.modes={DEFAULT:"def"}})(chatease);(function(f){f.core.renders.skins={}})(chatease);(function(f){f.core.renders.skins.modes={DEFAULT:"def"}})(chatease);
(function(f){var g=f.utils,e=f.events,b=g.css;f.core.renders.skins.def=function(a){var d=g.extend(this,new e.eventdispatcher("skins.def"));b(".chatwrap",{width:a.width+"px",height:a.height+"px","box-shadow":"0 1px 1px rgba(0, 0, 0, 0.05)"});b(".chatwrap *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});b(".render",{width:a.width-2+"px",height:a.height-2+"px",border:"1px solid #1184ce","border-radius":"4px",
position:"relative"});b(" .title",{padding:"auto 12px",width:"100%",height:"34px","font-family":"inherit","font-weight":"normal",color:"#fff","text-align":"center","line-height":"34px","vertical-align":"middle","box-shadow":"none","background-color":"#1184ce",cursor:"not-allowed","pointer-events":"none"});b(" .title span",{top:"2px","margin-left":"2px"});b(" .main",{width:"100%",height:a.height-2-parseInt("34px")+"px"});b(" .main .console",{width:"100%",height:.75*(a.height-parseInt("34px"))+"px",
"max-height":"75%","overflow-y":"auto","background-color":"#f8f8f8"});b(" .main .console > div",{margin:"5px","word-break":"break-all","word-wrap":"break-word"});b(" .main .console > div > span",{"margin-right":"5px"});b(" .main .console > div > span.vip1",{});b(" .main .console > div > span.vip2",{});b(" .main .console > div > span.vip3",{});b(" .main .console > div > span.vip4",{});b(" .main .console > div > span.vip5",{});b(" .main .console > div > span.vip6",{});b(" .main .console > div > span.vip7",
{});b(" .main .console > div > span.temporary",{});b(" .main .console > div > span.manager",{});b(" .main .console > div > span.owner",{});b(" .main .console > div > span.system",{});b(" .main .console > div > span.admin",{});b(" .main .console > div > a",{"margin-right":"5px",color:"#1184ce","text-decoration":"none",cursor:"pointer"});b(" .main .console > div.system > a",{"font-style":"normal","font-weight":"bold",color:"red"});b(" .main .console > div.myself",{});b(" .main .console > div.myself > a",
{});b(" .main .dialog",{width:"100%",height:.25*(a.height-1-parseInt("34px"))+"px",position:"relative",overflow:"hidden"});b(" .main .dialog .control",{width:"100%",height:"38px",border:"1px solid #1184ce","border-width":"1px 0"});b(" .main .dialog .control > *",{margin:"0 5px",height:"100%","line-height":"38px","text-align":"center","vertical-align":"middle","box-sizing":"border-box",display:"inline-block"});b(" .main .dialog .control > div > .ch",{color:"#666","vertical-align":"middle",cursor:"pointer"});
b(" .main .dialog .control > div > .ch input[type=checkbox]",{"margin-right":"5px",cursor:"pointer"});b(" .main .dialog .control > div > .ch a",{});b(" .main .dialog .control > div > .btn",{padding:"3px 5px",color:"#fff","text-align":"center","vertical-align":"middle","border-radius":"3px","background-color":"#1184ce",cursor:"pointer"});b(" .main .dialog .control .msgshield",{"float":"left"});b(" .main .dialog .control .clrscreen",{"float":"right"});b(" .main .dialog .control .clrscreen span",{top:"2px",
"margin-left":"2px"});b(" .main .dialog .input",{position:"relative"});b(" .main .dialog .input textarea",{"float":"left",margin:"0",padding:"5px 10px",width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",resize:"none",border:"0 none","border-radius":"0 0 0 4px","box-sizing":"border-box",overflow:"auto"});b(" .main .dialog .input button",{"float":"left",padding:0,width:"46px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",color:"#fff",
border:"0 none","box-sizing":"border-box","background-color":"#1184ce",cursor:"pointer"});g.isMSIE(7)&&(b(" .main .dialog .input textarea",{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),b(" .main .dialog .input button",{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}));d.resize=function(d,e){g.log("Resizing to "+d+", "+e);a.width=parseInt(d);a.height=parseInt(e);var f=document.getElementById(a.id),u=document.getElementById(a.prefix+
"render"),h=document.getElementById(a.prefix+"main"),w=document.getElementById(a.prefix+"console"),m=document.getElementById(a.prefix+"dialog"),k=document.getElementById(a.prefix+"input"),q=document.getElementById(a.prefix+"submit");b.style(f,{width:a.width+"px",height:a.height+"px"});b.style(u,{width:a.width-2+"px",height:a.height-2+"px"});b.style(h,{height:a.height-2-parseInt("34px")+"px"});b.style(w,{height:.75*(a.height-parseInt("34px"))+"px"});b.style(m,{height:.25*(a.height-1-parseInt("34px"))+
"px"});b.style(k,{width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});b.style(q,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});g.isMSIE(7)&&(b.style(k,{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),b.style(q,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}))}}})(chatease);
(function(f){var g=f.utils,e=f.events;f=f.core.renders;var b=f.skins,a=b.modes;f.def=function(d,c){function f(a){var b="";switch(g.typeOf(a)){case "string":if(a=parseInt(a),NaN==a||0>a)break;case "number":a&128?b="admin":a&64||(a&32?b="owner":a&16?b="manager":a&8&&(b="temporary")),a&7&&(b+=(b.length?" ":"")+"vip"+(a&7))}return b}function n(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?r.value+="\r\n":(h.send(),window.event?window.event.returnValue=!1:a.preventDefault()))}function u(a){h.send()}var h=
g.extend(this,new e.eventdispatcher("renders.def")),w={minWidth:300,minHeight:340,skin:{name:a.DEFAULT},prefix:"chat-"},m,k,q,l,v,p,r,t;h.show=function(a,b){var c=g.createElement("div"),r;switch(g.typeOf(a)){case "object":r=a.text;if("uni"==a.type){var t=g.createElement("span");t.innerHTML="[\u5bc6\u8bed]";c.appendChild(t)}break;default:r=a}switch(g.typeOf(b)){case "string":if(""===b)break;b={id:0,name:b,channel:{id:0,role:0,state:3}};case "null":b={id:0,name:"[\u7cfb\u7edf]",channel:{id:0,role:64,
state:3}};case "object":if(null==g.typeOf(b.id))break;if(t=0<=b.channel.role&&b.channel.role&64?"system":b.id==d.user().id?"myself":"")c.className=t;if(t=f(b.channel.role)){var n=g.createElement("span",t);n.innerHTML=t.substr(0,1);c.appendChild(n)}t=g.createElement("a");t.user=g.extend({},b);t.innerHTML=b.name;try{t.addEventListener("click",function(a){h.dispatchEvent(e.CHATEASE_VIEW_NICKCLICK,{user:{id:this.user.id,name:this.user.name},channel:this.user.channel})})}catch(k){t.attachEvent("onclick",
function(a){h.dispatchEvent(e.CHATEASE_VIEW_NICKCLICK,{user:{id:this.user.id,name:this.user.name},channel:this.user.channel})})}c.appendChild(t)}c.insertAdjacentHTML("beforeend",r);q.childNodes.length>=h.config.maxRecords&&q.removeChild(q.childNodes[0]);q.appendChild(c);q.scrollTop=q.scrollHeight};h.send=function(){for(var a=0;a<h.config.channel.length;a++)h.dispatchEvent(e.CHATEASE_VIEW_SEND,{data:{text:r.value,type:"multi",channel:h.config.channel[a]}});h.clearInput()};h.clearInput=function(){r.value=
""};h.clearScreen=function(){g.emptyElement(q)};h.element=function(){return m};h.resize=function(a,b){a=a||m.offsetWidth||c.width;b=b||m.offsetHeight||c.height;t&&t.resize(Math.max(a,h.config.minWidth),Math.max(b,h.config.minHeight))};h.destroy=function(){};h.config=g.extend({},w,c);h.config.width=Math.max(h.config.width,h.config.minWidth);h.config.height=Math.max(h.config.height,h.config.minHeight);m=g.createElement("div","render");k=g.createElement("div","title");w=g.createElement("div","main");
m.appendChild(k);m.appendChild(w);q=g.createElement("div","console");l=g.createElement("div","dialog");w.appendChild(q);w.appendChild(l);v=g.createElement("div","control");p=g.createElement("div","input");l.appendChild(v);l.appendChild(p);k.innerHTML="\u804a\u5929\u5ba4";(function(a,b,c,d,e){a=g.createElement("div",a);var r=g.createElement("label","ch"),f=g.createElement("input");f.type="checkbox";f.checked=!!e;try{f.addEventListener("change",function(a){h.dispatchEvent(b,g.extend({shield:f.checked},
c))})}catch(t){f.attachEvent("onchange",function(a){h.dispatchEvent(b,g.extend({shield:f.checked},c))})}r.appendChild(f);e=g.createElement("a");e.innerHTML=d;r.appendChild(e);a.appendChild(r);v.appendChild(a)})("msgshield",e.CHATEASE_VIEW_SHIELDMSG,null,"\u5c4f\u853d\u6d88\u606f",!1);(function(a,b,c,d,e){a=g.createElement("div",a);e=g.createElement("a","btn");e.innerHTML=d;try{e.addEventListener("click",function(a){h.dispatchEvent(b,c)})}catch(r){e.attachEvent("onclick",function(a){h.dispatchEvent(b,
c)})}a.appendChild(e);v.appendChild(a)})("clrscreen",e.CHATEASE_VIEW_CLEARSCREEN,null,"\u6e05\u5c4f","glyphicon glyphicon-trash");r=g.createElement("textarea");r.setAttribute("placeholder","\u8f93\u5165\u804a\u5929\u5185\u5bb9");h.config.maxlength&&r.setAttribute("maxlength",h.config.maxlength);try{r.addEventListener("keypress",n)}catch(y){r.attachEvent("onkeypress",n)}p.appendChild(r);k=g.createElement("button");k.innerHTML="\u53d1\u9001";try{k.addEventListener("click",u)}catch(y){k.attachEvent("onclick",
u)}p.appendChild(k);m.id=h.config.prefix+"render";w.id=h.config.prefix+"main";q.id=h.config.prefix+"console";l.id=h.config.prefix+"dialog";r.id=h.config.prefix+"input";k.id=h.config.prefix+"submit";try{t=new b[h.config.skin.name](h.config)}catch(y){g.log("Failed to init skin["+h.config.skin.name+"].")}t||h.dispatchEvent(e.CHATEASE_RENDER_ERROR,{message:"No suitable skin found!",skin:h.config.skin.name})}})(chatease);
(function(f){var g=f.utils,e=f.events;f.core.userattributes=function(b,a){function d(a){var b=-1;0>a?b=3E3:0==a?b=2E3:8<=a?b=0:0<(a&7)&&(b=1E3);return b}var c=g.extend(this,new e.eventdispatcher("core.channel_"+a)),f=-1,n=0,u,h=0,w=!1,m={code:0,time:0};c.getId=function(){return a};c.getRole=function(){return f};c.getState=function(){return n};c.getInterval=function(){return u};c.setProperties=function(a,b){f=a;n=b;u=d(f);w=!0};c.setPunishment=function(a){m.code=a.code;m.time=a.time};c.getPunishment=
function(){return 0==m.code||m.time>=(new Date).getTime()?(m.code=0,m.time=0,null):g.extend({},m)};c.setActive=function(){var a=(new Date).getTime();if(0<h&&(0>u||a-h<u))return!1;h=a;return!0};c.joined=function(){return w};u=d(f)}})(chatease);
(function(f){var g=f.utils,e=f.events,b=f.core;b.entity=function(a){var d=g.extend(this,new e.eventdispatcher("core.entity")),c,f,n;d.setup=function(){f.setup()};d.destroy=function(){n&&n.stop();f&&f.destroy();c&&c.destroy()};d.id=a.id;d.model=c=new b.model(a);d.view=f=new b.view(d,c);d.controller=n=new b.controller(c,f);n.addGlobalListener(function(a){d.dispatchEvent(a.type,a)});d.send=n.send;d.join=n.join;d.resize=f.resize}})(chatease);
(function(f){var g=f.utils,e=f.events,b=f.core,a=b.states;b.model=function(d){var c=g.extend(this,new e.eventdispatcher("core.model")),f={};c.setState=function(a){a!==c.state&&(c.state=a,c.dispatchEvent(e.CHATEASE_STATE,{state:a}))};c.setMsgShield=function(a){a!==c.shieldMsg&&(c.shieldMsg=a,c.dispatchEvent(e.CHATEASE_VIEW_SHIELDMSG,{shield:a}))};c.getConfig=function(a){return c.config[a]||{}};c.getAttributes=function(a){0==f.hasOwnProperty(a)&&(f[a]=new b.userattributes(c,a));return f[a]};c.destroy=
function(){};c.config=g.extend({},{},d);g.extend(c,{id:d.id,user:{id:NaN,name:""},state:a.CLOSED,shieldMsg:!1},c.config)}})(chatease);
(function(f){var g=f.utils,e=f.events;f=f.core;var b=f.renders,a=b.modes;f.view=function(d,c){function f(){switch(c.render.name){case a.DEFAULT:var d=g.extend(c.getConfig("render"),{id:c.id,width:c.width,height:c.height,channel:c.channel,maxlength:c.maxlength,maxRecords:c.maxRecords});l.render=p=new b[a.DEFAULT](l,d);break;default:l.dispatchEvent(e.CHATEASE_SETUP_ERROR,{message:"Unknown render mode!",render:c.render.name})}p&&(p.addEventListener(e.CHATEASE_VIEW_SEND,n),p.addEventListener(e.CHATEASE_VIEW_SHIELDMSG,
u),p.addEventListener(e.CHATEASE_VIEW_CLEARSCREEN,h),p.addEventListener(e.CHATEASE_VIEW_NICKCLICK,w),p.addEventListener(e.CHATEASE_RENDER_ERROR,m),v.appendChild(p.element()))}function n(a){k(a)}function u(a){k(a)}function h(a){k(a)}function w(a){k(a)}function m(a){k(a)}function k(a){l.dispatchEvent(a.type,a)}function q(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:p.send()}if(/13/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}var l=g.extend(this,new e.eventdispatcher("core.view")),
v,p;l.setup=function(){f();try{v.addEventListener("keydown",q)}catch(a){v.attachEvent("onkeydown",q)}setTimeout(function(){l.dispatchEvent(e.CHATEASE_READY,{channelId:d.id})},0)};l.show=function(a,b){c.shieldMsg||p&&p.show(a,b)};l.user=function(){return c.user};l.resize=function(a,b){p&&p.resize(a,b)};l.destroy=function(){v&&v.removeEventListener("keydown",q);p&&p.destroy()};(function(){v=g.createElement("div","chatwrap");v.id=d.id;v.tabIndex=0;var a=document.getElementById(d.id);a.parentNode.replaceChild(v,
a);window.onresize=function(){"function"==g.typeOf(c.onresize)?c.onresize.call(null):l.resize()}})()}})(chatease);
(function(f){var g=f.utils,e=f.events;f=f.core;var b=f.states;f.controller=function(a,d){function c(){if(!l){d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{l=window.WebSocket?new WebSocket(a.url):window.MozWebSocket?new MozWebSocket(a.url):new SockJS(a.url.replace(/^ws/,"http")+"/sockjs")}catch(c){g.log("Failed to initialize websocket.");return}l.onopen=function(c){a.setState(b.CONNECTED)};l.onmessage=f;l.onerror=function(c){a.setState(b.ERROR)};l.onclose=function(c){a.setState(b.CLOSED)}}}
function f(b){var c;try{c=eval("("+b.data+")")}catch(l){g.log("Eval failed. \nerr: "+l+"\ndata: "+b.data);return}switch(c.raw){case "identity":g.foreach(c.user,function(b,c){a.user.hasOwnProperty(b)&&(a.user[b]=c)});d.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+c.channel.id+"\uff09\u3002");var m=a.getAttributes(c.channel.id);m.setProperties(c.channel.role,c.channel.state);0==(c.channel.state&2)&&d.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");1==c.channel.hasOwnProperty("punishment")&&
(b=c.channel.punishment,m.setPunishment(b),0<(b.code&2)&&(m=new Date,m.setTime(b.time),d.show("\u60a8\u5df2\u88ab\u7981\u8a00\uff08"+g.formatTime(m)+"\uff09\uff01")));k.dispatchEvent(e.CHATEASE_INDENT,c);break;case "message":try{v||(v=new g.filter(a.keywords)),c.text=v.replace(c.text)}catch(l){g.log("Failed to execute filter.")}d.show(c,g.extend({},c.user,{channel:c.channel}));k.dispatchEvent(e.CHATEASE_MESSAGE,c);break;case "join":d.show(h(c.channel.role)+" "+c.user.name+" \u8fdb\u5165\u804a\u5929\u5ba4\u3002");
k.dispatchEvent(e.CHATEASE_JOIN,c);break;case "left":d.show(h(c.channel.role)+" "+c.user.name+" \u5df2\u79bb\u5f00\u3002");k.dispatchEvent(e.CHATEASE_LEFT,c);break;case "error":n(c.error.code,c);break;default:g.log("Unknown data type: "+c.raw+", ignored.")}}function n(a,b){var c=u(a);c&&d.show(c);var f={raw:"error",error:{code:a,explain:c}};g.foreach(b,function(a,b){"cmd"!=a&&"raw"!=a&&"error"!=a&&(f[a]=b)});k.dispatchEvent(e.CHATEASE_ERROR,f)}function u(a){var b="";switch(a){case 400:b="\u9519\u8bef\u8bf7\u6c42\uff01";
break;case 401:b="\u8bf7\u5148\u767b\u5f55\uff01";break;case 403:b="\u6743\u9650\u9519\u8bef\uff01";break;case 404:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case 406:b="\u975e\u6cd5\u8bf7\u6c42\uff01";break;case 409:b="\u64cd\u4f5c\u9891\u7e41\uff01"}return b}function h(a){var b="";switch(g.typeOf(a)){case "string":if(a=parseInt(a),NaN==a||0>a)break;case "number":a&192?b="\u8d85\u7ba1":a&32?b="\u4e3b\u64ad":a&24?b="\u623f\u7ba1":a&7&&(b="VIP"+(a&7))}return b}function w(){if(!a.maxRetries||p<a.maxRetries){var b=
Math.ceil(a.retryDelay+5E3*Math.random());d.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+b/1E3+"\u79d2...");setTimeout(function(){p++;l=null;c()},b)}}function m(a){k.dispatchEvent(a.type,a)}var k=g.extend(this,new e.eventdispatcher("core.controller")),q=!1,l,v,p=0;k.send=function(d){if(l&&a.state!=b.CLOSED)if("object"!=g.typeOf(d)||0==d.hasOwnProperty("cmd")||0==d.hasOwnProperty("channel")||0==d.channel.hasOwnProperty("id"))n(400,d);else{var e=a.getAttributes(d.channel.id);0==e.setActive()?n(409,
d):(e=e.getPunishment(),null!=e&&0<(e.code&2)?n(403,d):l.send(JSON.stringify(d)))}else c()};k.join=function(b){b={cmd:"join",channel:{id:b}};a.token&&(b.token=a.token);k.send(b)};k.close=function(){l&&l.close()};a.addEventListener(e.CHATEASE_STATE,function(c){switch(c.state){case b.CONNECTED:d.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");p=0;k.dispatchEvent(e.CHATEASE_CONNECT);for(c=0;c<a.channel.length;c++)k.join(a.channel[c]);break;case b.CLOSED:d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");
k.dispatchEvent(e.CHATEASE_CLOSE,{channel:{id:a.channel}});w();break;case b.ERROR:d.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");k.dispatchEvent(e.CHATEASE_ERROR,{message:"Chat room error!",channel:{id:a.channel}});break;default:k.dispatchEvent(e.CHATEASE_ERROR,{message:"Unknown model state!",state:c.state})}});a.addEventListener(e.CHATEASE_VIEW_SHIELDMSG,function(a){m(a)});d.addEventListener(e.CHATEASE_READY,function(d){q||(m(d),q=!0,c(),window.onbeforeunload=function(c){l&&a.state==b.CONNECTED&&
l.close()})});d.addEventListener(e.CHATEASE_VIEW_SEND,function(b){b.data.text=g.trim(a.maxlength?b.data.text.substr(0,a.maxlength):b.data.text);b.data.text?k.send({cmd:"message",text:b.data.text,type:b.data.type,channel:{id:b.data.channel}}):d.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});d.addEventListener(e.CHATEASE_VIEW_SHIELDMSG,function(b){a.setMsgShield(b.shield)});d.addEventListener(e.CHATEASE_VIEW_CLEARSCREEN,function(a){d.render.clearScreen();m(a)});d.addEventListener(e.CHATEASE_VIEW_NICKCLICK,
function(a){m(a)});d.addEventListener(e.CHATEASE_SETUP_ERROR,function(a){m(a)});d.addEventListener(e.CHATEASE_RENDER_ERROR,function(a){m(a)})}})(chatease);
(function(f){var g=f.utils,e=f.events,b=f.embed=function(a){function d(a){switch(a.type){case e.ERROR:case e.CHATEASE_SETUP_ERROR:case e.CHATEASE_RENDER_ERROR:case e.CHATEASE_ERROR:c.errorScreen(a.message);c.dispatchEvent(e.ERROR,a);break;default:c.dispatchEvent(a.type,a)}}var c=g.extend(this,new e.eventdispatcher("embed")),x={},n=!1,u=null;c.embed=function(){try{x=new b.config(a.config),u=new b.embedder(a,x)}catch(f){g.log("Failed to init embedder!");c.dispatchEvent(e.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",
render:x.render.name});return}u.addGlobalListener(d);u.embed()};c.errorScreen=function(a){n||(n=!0,f.api.displayError(a,x))};(function(){g.foreach(a.config.events,function(b,c){var d=a[b];"function"===g.typeOf(d)&&d.call(a,c)})})()}})(chatease);
(function(f){var g=f.utils,e=f.embed,b=f.core.renders.modes,a=f.core.renders.skins.modes;e.config=function(d){d=g.extend({},{url:"ws://"+window.location.host+"/websocket/websck",width:300,height:450,channel:1,maxlength:30,maxRetries:0,retryDelay:3E3,render:{name:b.DEFAULT,skin:{name:a.DEFAULT}},token:"",keywords:"",maxRecords:50},d);switch(g.typeOf(d.channel)){case "array":break;case "number":d.channel=[d.channel];break;case "string":d.channel=d.channel.split(",");break;default:d.channel=[1]}return d};
e.config.addConfig=function(a,b){return g.extend(a,b)}})(chatease);(function(f){var g=f.utils,e=f.events,b=f.core;f.embed.embedder=function(a,d){function c(a){f.dispatchEvent(a.type,a)}var f=g.extend(this,new e.eventdispatcher("embed.embedder"));f.embed=function(){var e=new b.entity(d);e.addGlobalListener(c);e.setup();a.setEntity(e,d.render.name)}}})(chatease);