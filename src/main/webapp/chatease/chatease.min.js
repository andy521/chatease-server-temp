chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="0.1.19";chatease.debug=!1;
(function(f){function g(a){return null!==navigator.userAgent.toLowerCase().match(a)}var c=f.utils={};c.exists=function(a){switch(c.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};c.extend=function(){var a=Array.prototype.slice.call(arguments,0),e=a[0];if(1<a.length)for(var d=1;d<a.length;d++)c.foreach(a[d],function(a,d){void 0!==d&&null!==d&&(e[a]=d)});return e};c.foreach=function(a,e){for(var d in a)a.hasOwnProperty&&"function"===c.typeOf(a.hasOwnProperty)?
a.hasOwnProperty(d)&&e(d,a[d]):e(d,a[d])};c.getCookie=function(a){var e;return(e=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(e[2]):null};c.createElement=function(a,e){var d=document.createElement(a);e&&(d.className=e);return d};c.addClass=function(a,e){var d="string"===c.typeOf(a.className)?a.className.split(" "):[],n="array"===c.typeOf(e)?e:e.split(" ");c.foreach(n,function(a,e){-1===c.indexOf(d,e)&&d.push(e)});a.className=c.trim(d.join(" "))};c.removeClass=function(a,
e){var d="string"===c.typeOf(a.className)?a.className.split(" "):[],n="array"===c.typeOf(e)?e:e.split(" ");c.foreach(n,function(a,e){var n=c.indexOf(d,e);0<=n&&d.splice(n,1)});a.className=c.trim(d.join(" "))};c.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};c.typeOf=function(a){if(null===a||void 0===a)return"null";var e=typeof a;if("object"===e)try{if("[object Array]"===toString.call(a))return"array"}catch(d){}return e};c.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};
c.indexOf=function(a,e){if(null==a)return-1;for(var d=0;d<a.length;d++)if(a[d]===e)return d;return-1};c.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),g(new RegExp("msie\\s*"+a,"i"))):g(/msie/i)};var b=window.console=window.console||{log:function(){}};c.log=function(){var a=Array.prototype.slice.call(arguments,0);"object"===c.typeOf(b.log)?b.log(a):b.log.apply(b,a)}})(chatease);
(function(f){function g(){var a=document.createElement("style");a.type="text/css";document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet}var c=f.utils,b;(c.css=function(a,e){b||(b=g());var d="";c.foreach(e,function(a,e){d+=a+": "+e+"; "});try{b.insertRule?b.insertRule(a+" { "+d+"}",b.cssRules.length):b.addRule(a,d,b.rules.length)}catch(n){c.log("Failed to insert css rule: "+a)}}).style=function(a,e,d){if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),e=c.extend({},
e),d=0;d<a.length;d++){var n=a[d];void 0!==n&&null!==n&&c.foreach(e,function(a,d){var e;e=a.split("-");for(var c=1;c<e.length;c++)e[c]=e[c].charAt(0).toUpperCase()+e[c].slice(1);e=e.join("");n.style[e]!==d&&(n.style[e]=d)})}}})(chatease);(function(f){var g=f.utils;g.filter=function(c){var b,a="";this.replace=function(e){return a&&b?e.replace(b,"**"):e};"string"==g.typeOf(c)&&c&&(a=c,b=new RegExp(a,"ig"))}})(chatease);
(function(f){f.events={ERROR:"ERROR",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_ERROR:"chateaseError",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_SHIELDMSG:"chateaseViewMsgShield",CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",
CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(f){var g=f.utils;f.events.eventdispatcher=function(c){function b(a,e,c){if(a)for(var b=0;b<a.length;b++){var f=a[b];if(f){null!==f.count&&0===--f.count&&delete a[b];try{f.listener(e)}catch(x){g.log('Error handling "'+c+'" event listener ['+b+"]: "+x.toString(),f.listener,e)}}}}var a={},e=[];this.addEventListener=function(d,e,c){try{g.exists(a[d])||(a[d]=[]),"string"===g.typeOf(e)&&(e=(new Function("return "+e))()),a[d].push({listener:e,count:c||null})}catch(b){g.log("error",b)}return!1};
this.removeEventListener=function(d,e){if(a[d]){try{if(void 0===e){a[d]=[];return}var c;for(c=0;c<a[d].length;c++)if(a[d][c].listener.toString()===e.toString()){a[d].splice(c,1);break}}catch(b){g.log("error",b)}return!1}};this.addGlobalListener=function(a,c){try{"string"===g.typeOf(a)&&(a=(new Function("return "+a))()),e.push({listener:a,count:c||null})}catch(b){g.log("error",b)}return!1};this.removeGlobalListener=function(a){if(a){try{var c;for(c=e.length-1;0<=c;c--)e[c].listener.toString()===a.toString()&&
e.splice(c,1)}catch(b){g.log("error",b)}return!1}};this.dispatchEvent=function(d,n){n||(n={});g.extend(n,{id:c,version:f.version,type:d});f.debug&&g.log(d,n);b(a[d],n,d);b(e,n,d)}}})(chatease);
(function(f){var g=f.utils,c=f.events,b={},a={onError:c.ERROR,onReady:c.CHATEASE_READY,onConnect:c.CHATEASE_CONNECT,onIdent:c.CHATEASE_INDENT,onMessage:c.CHATEASE_MESSAGE,onJoin:c.CHATEASE_JOIN,onLeft:c.CHATEASE_LEFT,onNickClick:c.CHATEASE_VIEW_NICKCLICK,onClose:c.CHATEASE_CLOSE};f.api=function(e){function d(a){b.dispatchEvent(a.type,a)}var b=g.extend(this,new c.eventdispatcher("api")),m;b.container=e;b.id=e.id;b.setup=function(a){g.emptyElement(b.container);b.config=a;b.config.id=b.id;b.embedder=
new f.embed(b);b.embedder.addGlobalListener(d);b.embedder.embed();return b};b.setEntity=function(a,e){m=a;b.renderName=e;b.send=m.send;b.join=m.join;b.resize=m.resize};(function(){g.foreach(a,function(a,e){b[a]=function(a){b.addEventListener(e,a)}})})()};f.api.getInstance=function(a){var d;null==a?a=0:a.nodeType?d=a:"string"===g.typeOf(a)&&(d=document.getElementById(a));if(d){var c=b[d.id];c||(b[a]=c=new f.api(d));return c}return"number"===g.typeOf(a)?b[a]:null};f.api.displayError=function(a,b){}})(chatease);
(function(f){f.core={}})(chatease);(function(f){f.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);(function(f){f.core.renders={}})(chatease);(function(f){f.core.renders.modes={DEFAULT:"def"}})(chatease);(function(f){f.core.renders.skins={}})(chatease);(function(f){f.core.renders.skins.modes={DEFAULT:"def"}})(chatease);
(function(f){var g=f.utils,c=f.events,b=g.css;f.core.renders.skins.def=function(a){var e=g.extend(this,new c.eventdispatcher("skins.def"));b(".chatwrap",{width:a.width+"px",height:a.height+"px","box-shadow":"0 1px 1px rgba(0, 0, 0, 0.05)"});b(".chatwrap *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});b(".render",{width:a.width-2+"px",height:a.height-2+"px",border:"1px solid #1184ce","border-radius":"4px",
position:"relative"});b(" .title",{padding:"auto 12px",width:"100%",height:"34px","font-family":"inherit","font-weight":"normal",color:"#fff","text-align":"center","line-height":"34px","vertical-align":"middle","box-shadow":"none","background-color":"#1184ce",cursor:"not-allowed","pointer-events":"none"});b(" .title span",{top:"2px","margin-left":"2px"});b(" .main",{width:"100%",height:a.height-2-parseInt("34px")+"px"});b(" .main .console",{width:"100%",height:.75*(a.height-parseInt("34px"))+"px",
"max-height":"75%","overflow-y":"auto","background-color":"#f8f8f8"});b(" .main .console > div",{margin:"5px","word-break":"break-all","word-wrap":"break-word"});b(" .main .console > div > span",{"margin-right":"5px"});b(" .main .console > div > span.vip1",{});b(" .main .console > div > span.vip2",{});b(" .main .console > div > span.vip3",{});b(" .main .console > div > span.vip4",{});b(" .main .console > div > span.vip5",{});b(" .main .console > div > span.vip6",{});b(" .main .console > div > span.vip7",
{});b(" .main .console > div > span.temporary",{});b(" .main .console > div > span.manager",{});b(" .main .console > div > span.owner",{});b(" .main .console > div > span.system",{});b(" .main .console > div > span.admin",{});b(" .main .console > div > a",{"margin-right":"5px",color:"#1184ce","text-decoration":"none",cursor:"pointer"});b(" .main .console > div.system > a",{"font-style":"normal","font-weight":"bold",color:"red"});b(" .main .console > div.myself",{});b(" .main .console > div.myself > a",
{});b(" .main .dialog",{width:"100%",height:.25*(a.height-1-parseInt("34px"))+"px",position:"relative",overflow:"hidden"});b(" .main .dialog .control",{width:"100%",height:"38px",border:"1px solid #1184ce","border-width":"1px 0"});b(" .main .dialog .control > *",{margin:"0 5px",height:"100%","line-height":"38px","text-align":"center","vertical-align":"middle","box-sizing":"border-box",display:"inline-block"});b(" .main .dialog .control > div > .ch",{color:"#666","vertical-align":"middle",cursor:"pointer"});
b(" .main .dialog .control > div > .ch input[type=checkbox]",{"margin-right":"5px",cursor:"pointer"});b(" .main .dialog .control > div > .ch a",{});b(" .main .dialog .control > div > .btn",{padding:"3px 5px",color:"#fff","text-align":"center","vertical-align":"middle","border-radius":"3px","background-color":"#1184ce",cursor:"pointer"});b(" .main .dialog .control .msgshield",{"float":"left"});b(" .main .dialog .control .clrscreen",{"float":"right"});b(" .main .dialog .control .clrscreen span",{top:"2px",
"margin-left":"2px"});b(" .main .dialog .input",{position:"relative"});b(" .main .dialog .input textarea",{"float":"left",margin:"0",padding:"5px 10px",width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",resize:"none",border:"0 none","border-radius":"0 0 0 4px","box-sizing":"border-box",overflow:"auto"});b(" .main .dialog .input button",{"float":"left",padding:0,width:"46px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",color:"#fff",
border:"0 none","box-sizing":"border-box","background-color":"#1184ce",cursor:"pointer"});g.isMSIE(7)&&(b(" .main .dialog .input textarea",{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),b(" .main .dialog .input button",{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}));e.resize=function(c,e){g.log("Resizing to "+c+", "+e);a.width=parseInt(c);a.height=parseInt(e);var f=document.getElementById(a.id),u=document.getElementById(a.prefix+
"render"),h=document.getElementById(a.prefix+"main"),x=document.getElementById(a.prefix+"console"),v=document.getElementById(a.prefix+"dialog"),k=document.getElementById(a.prefix+"input"),q=document.getElementById(a.prefix+"submit");b.style(f,{width:a.width+"px",height:a.height+"px"});b.style(u,{width:a.width-2+"px",height:a.height-2+"px"});b.style(h,{height:a.height-2-parseInt("34px")+"px"});b.style(x,{height:.75*(a.height-parseInt("34px"))+"px"});b.style(v,{height:.25*(a.height-1-parseInt("34px"))+
"px"});b.style(k,{width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});b.style(q,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});g.isMSIE(7)&&(b.style(k,{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),b.style(q,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}))}}})(chatease);
(function(f){var g=f.utils,c=f.events;f=f.core.renders;var b=f.skins,a=b.modes;f.def=function(e,d){function f(a){var c="";switch(g.typeOf(a)){case "string":if(a=parseInt(a),NaN==a||0>a)break;case "number":a&128?c="admin":a&64||(a&32?c="owner":a&16?c="manager":a&8&&(c="temporary")),a&7&&(c+=(c.length?" ":"")+"vip"+(a&7))}return c}function m(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?r.value+="\r\n":(h.send(),window.event?window.event.returnValue=!1:a.preventDefault()))}function u(a){h.send()}var h=
g.extend(this,new c.eventdispatcher("renders.def")),x={skin:{name:a.DEFAULT},prefix:"chat-"},v,k,q,l,w,p,r,t;h.show=function(a,b){var d=g.createElement("div"),r;switch(g.typeOf(a)){case "object":r=a.text;if("uni"==a.type){var t=g.createElement("span");t.innerHTML="[\u5bc6\u8bed]";d.appendChild(t)}break;default:r=a}switch(g.typeOf(b)){case "string":if(""===b)break;b={id:0,name:b,role:0};case "null":b={id:0,name:"[\u7cfb\u7edf]",role:64};case "object":if(null==g.typeOf(b.id))break;if(t=0<=b.role&&b.role&
64?"system":b.id==e.user().id?"myself":"")d.className=t;if(t=f(b.role)){var k=g.createElement("span",t);k.innerHTML=t.substr(0,1);d.appendChild(k)}t=g.createElement("a");t.user=g.extend({},b);t.innerHTML=b.name;try{t.addEventListener("click",function(a){h.dispatchEvent(c.CHATEASE_VIEW_NICKCLICK,{user:this.user})})}catch(m){t.attachEvent("onclick",function(a){h.dispatchEvent(c.CHATEASE_VIEW_NICKCLICK,{user:this.user})})}d.appendChild(t)}d.insertAdjacentHTML("beforeend",r);q.childNodes.length>=h.config.maxRecords&&
q.removeChild(q.childNodes[0]);q.appendChild(d);q.scrollTop=q.scrollHeight};h.send=function(){for(var a=0;a<h.config.channel.length;a++)h.dispatchEvent(c.CHATEASE_VIEW_SEND,{data:{text:r.value,type:"multi",channel:h.config.channel[a]}});h.clearInput()};h.clearInput=function(){r.value=""};h.clearScreen=function(){g.emptyElement(q)};h.element=function(){return v};h.resize=function(a,b){a=a||v.offsetWidth||d.width;b=b||v.offsetHeight||d.height;t&&t.resize(a,b)};h.destroy=function(){};h.config=g.extend({},
x,d);v=g.createElement("div","render");k=g.createElement("div","title");x=g.createElement("div","main");v.appendChild(k);v.appendChild(x);q=g.createElement("div","console");l=g.createElement("div","dialog");x.appendChild(q);x.appendChild(l);w=g.createElement("div","control");p=g.createElement("div","input");l.appendChild(w);l.appendChild(p);k.innerHTML="\u804a\u5929\u5ba4";(function(a,b,c,d,e){a=g.createElement("div",a);var r=g.createElement("label","ch"),f=g.createElement("input");f.type="checkbox";
f.checked=!!e;try{f.addEventListener("change",function(a){h.dispatchEvent(b,g.extend({shield:f.checked},c))})}catch(t){f.attachEvent("onchange",function(a){h.dispatchEvent(b,g.extend({shield:f.checked},c))})}r.appendChild(f);e=g.createElement("a");e.innerHTML=d;r.appendChild(e);a.appendChild(r);w.appendChild(a)})("msgshield",c.CHATEASE_VIEW_SHIELDMSG,null,"\u5c4f\u853d\u6d88\u606f",!1);(function(a,b,c,e,d){a=g.createElement("div",a);d=g.createElement("a","btn");d.innerHTML=e;try{d.addEventListener("click",
function(a){h.dispatchEvent(b,c)})}catch(r){d.attachEvent("onclick",function(a){h.dispatchEvent(b,c)})}a.appendChild(d);w.appendChild(a)})("clrscreen",c.CHATEASE_VIEW_CLEARSCREEN,null,"\u6e05\u5c4f","glyphicon glyphicon-trash");r=g.createElement("textarea");r.setAttribute("placeholder","\u8f93\u5165\u804a\u5929\u5185\u5bb9");h.config.maxlength&&r.setAttribute("maxlength",h.config.maxlength);try{r.addEventListener("keypress",m)}catch(y){r.attachEvent("onkeypress",m)}p.appendChild(r);k=g.createElement("button");
k.innerHTML="\u53d1\u9001";try{k.addEventListener("click",u)}catch(y){k.attachEvent("onclick",u)}p.appendChild(k);v.id=h.config.prefix+"render";x.id=h.config.prefix+"main";q.id=h.config.prefix+"console";l.id=h.config.prefix+"dialog";r.id=h.config.prefix+"input";k.id=h.config.prefix+"submit";try{t=new b[h.config.skin.name](h.config)}catch(y){g.log("Failed to init skin["+h.config.skin.name+"].")}t||h.dispatchEvent(c.CHATEASE_RENDER_ERROR,{message:"No suitable skin found!",skin:h.config.skin.name})}})(chatease);
(function(f){var g=f.utils,c=f.events;f.core.channel=function(b,a){function e(a){var b=-1;0>a?b=3E3:0==a?b=2E3:8<=a?b=0:0<(a&7)&&(b=1E3);return b}var d=g.extend(this,new c.eventdispatcher("core.channel_"+a)),f=-1,m=0,u,h=0,x=!1;d.getId=function(){return a};d.getRole=function(){return f};d.getState=function(){return m};d.getInterval=function(){return u};d.setProperties=function(a,b){f=a;m=b;u=e(f);x=!0};d.setActive=function(){var a=(new Date).getTime();if(0<h&&(0>u||a-h<u))return!1;h=a;return!0};d.joined=
function(){return x};u=e(f)}})(chatease);(function(f){var g=f.utils,c=f.events,b=f.core;b.entity=function(a){var e=g.extend(this,new c.eventdispatcher("core.entity")),d,f,m;e.setup=function(){f.setup()};e.destroy=function(){m&&m.stop();f&&f.destroy();d&&d.destroy()};e.id=a.id;e.model=d=new b.model(a);e.view=f=new b.view(e,d);e.controller=m=new b.controller(d,f);m.addGlobalListener(function(a){e.dispatchEvent(a.type,a)});e.send=m.send;e.join=m.join;e.resize=f.resize}})(chatease);
(function(f){var g=f.utils,c=f.events,b=f.core,a=b.states;b.model=function(e){var d=g.extend(this,new c.eventdispatcher("core.model"));d.setState=function(a){a!==d.state&&(d.state=a,d.dispatchEvent(c.CHATEASE_STATE,{state:a}))};d.setMsgShield=function(a){a!==d.shieldMsg&&(d.shieldMsg=a,d.dispatchEvent(c.CHATEASE_VIEW_SHIELDMSG,{shield:a}))};d.getConfig=function(a){return d.config[a]||{}};d.getChannel=function(a){0==d.channels.hasOwnProperty(a)&&(d.channels[a]=new b.channel(d,a));return d.channels[a]};
d.destroy=function(){};d.config=g.extend({},{},e);g.extend(d,{id:e.id,user:{id:NaN,name:""},channels:{},state:a.CLOSED,shieldMsg:!1},d.config)}})(chatease);
(function(f){var g=f.utils,c=f.events;f=f.core;var b=f.renders,a=b.modes;f.view=function(e,d){function f(){switch(d.render.name){case a.DEFAULT:var e=g.extend(d.getConfig("render"),{id:d.id,width:d.width,height:d.height,channel:d.channel,maxlength:d.maxlength,maxRecords:d.maxRecords});l.render=p=new b[a.DEFAULT](l,e);break;default:l.dispatchEvent(c.CHATEASE_SETUP_ERROR,{message:"Unknown render mode!",render:d.render.name})}p&&(p.addEventListener(c.CHATEASE_VIEW_SEND,m),p.addEventListener(c.CHATEASE_VIEW_SHIELDMSG,
u),p.addEventListener(c.CHATEASE_VIEW_CLEARSCREEN,h),p.addEventListener(c.CHATEASE_VIEW_NICKCLICK,x),p.addEventListener(c.CHATEASE_RENDER_ERROR,v),w.appendChild(p.element()))}function m(a){k(a)}function u(a){k(a)}function h(a){k(a)}function x(a){k(a)}function v(a){k(a)}function k(a){l.dispatchEvent(a.type,a)}function q(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:p.send()}if(/13/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}var l=g.extend(this,new c.eventdispatcher("core.view")),
w,p;l.setup=function(){f();try{w.addEventListener("keydown",q)}catch(a){w.attachEvent("onkeydown",q)}setTimeout(function(){l.dispatchEvent(c.CHATEASE_READY,{channelId:e.id})},0)};l.show=function(a,b){d.shieldMsg||p&&p.show(a,b)};l.user=function(){return d.user};l.resize=function(a,b){p&&p.resize(a,b)};l.destroy=function(){w&&w.removeEventListener("keydown",q);p&&p.destroy()};(function(){w=g.createElement("div","chatwrap");w.id=e.id;w.tabIndex=0;var a=document.getElementById(e.id);a.parentNode.replaceChild(w,
a);window.onresize=function(){"function"==g.typeOf(d.onresize)?d.onresize.call(null):l.resize()}})()}})(chatease);
(function(f){var g=f.utils,c=f.events;f=f.core;var b=f.states;f.controller=function(a,e){function d(){if(!l){e.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{l=window.WebSocket?new WebSocket(a.url):window.MozWebSocket?new MozWebSocket(a.url):new SockJS(a.url.replace(/^ws/,"http")+"/sockjs")}catch(c){g.log("Failed to initialize websocket.");return}l.onopen=function(c){a.setState(b.CONNECTED)};l.onmessage=f;l.onerror=function(c){a.setState(b.ERROR)};l.onclose=function(c){a.setState(b.CLOSED)}}}
function f(b){var d;try{d=eval("("+b.data+")")}catch(l){g.log("Eval failed. \nerr: "+l+"\ndata: "+b.data);return}switch(d.raw){case "identity":g.foreach(d.user,function(b,d){a.user.hasOwnProperty(b)&&(a.user[b]=d)});a.getChannel(d.channel.id).setProperties(d.channel.role,d.channel.state);e.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+d.channel.id+"\uff09\uff01");k.dispatchEvent(c.CHATEASE_INDENT,d);break;case "message":try{w||(w=new g.filter(a.keywords)),d.text=w.replace(d.text)}catch(l){g.log("Failed to execute filter.")}e.show(d,
g.extend({role:d.channel.role,state:d.channel.state},d.user));k.dispatchEvent(c.CHATEASE_MESSAGE,d);break;case "join":e.show(h(d.channel.role)+" "+d.user.name+" \u8fdb\u5165\u804a\u5929\u5ba4\u3002");k.dispatchEvent(c.CHATEASE_JOIN,d);break;case "left":e.show(h(d.channel.role)+" "+d.user.name+" \u5df2\u79bb\u5f00\u3002");k.dispatchEvent(c.CHATEASE_LEFT,d);break;case "error":m(d.error.code,d);break;default:g.log("Unknown data type: "+d.raw+", ignored.")}}function m(a,b){var d=u(a);d&&e.show(d);var f=
{raw:"error",error:{code:a,explain:d}};g.foreach(b,function(a,b){"cmd"!=a&&"raw"!=a&&"error"!=a&&(f[a]=b)});k.dispatchEvent(c.CHATEASE_ERROR,f)}function u(a){var b="";switch(a){case 400:b="\u9519\u8bef\u8bf7\u6c42\uff01";break;case 401:b="\u8bf7\u5148\u767b\u5f55\uff01";break;case 403:b="\u6743\u9650\u9519\u8bef\uff01";break;case 404:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case 406:b="\u975e\u6cd5\u8bf7\u6c42\uff01";break;case 409:b="\u64cd\u4f5c\u9891\u7e41\uff01"}return b}function h(a){var b="";
switch(g.typeOf(a)){case "string":if(a=parseInt(a),NaN==a||0>a)break;case "number":a&192?b="\u8d85\u7ba1":a&32?b="\u4e3b\u64ad":a&24?b="\u623f\u7ba1":a&7&&(b="VIP"+(a&7))}return b}function x(){if(!a.maxRetries||p<a.maxRetries){var b=Math.ceil(a.retryDelay+5E3*Math.random());e.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+b/1E3+"\u79d2...");setTimeout(function(){p++;l=null;d()},b)}}function v(a){k.dispatchEvent(a.type,a)}var k=g.extend(this,new c.eventdispatcher("core.controller")),q=!1,l,w,p=
0;k.send=function(c){l&&a.state!=b.CLOSED?"object"!=g.typeOf(c)||0==c.hasOwnProperty("cmd")||0==c.hasOwnProperty("channel")||0==c.channel.hasOwnProperty("id")?m(400,c):0==a.getChannel(c.channel.id).setActive()?m(409,c):l.send(JSON.stringify(c)):d()};k.join=function(a){a={cmd:"join",channel:{id:a}};var b=g.getCookie("token");b&&(a.token=b);k.send(a)};k.close=function(){l&&l.close()};a.addEventListener(c.CHATEASE_STATE,function(d){switch(d.state){case b.CONNECTED:e.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");
p=0;k.dispatchEvent(c.CHATEASE_CONNECT);for(d=0;d<a.channel.length;d++)k.join(a.channel[d]);break;case b.CLOSED:e.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");k.dispatchEvent(c.CHATEASE_CLOSE,{channel:{id:a.channel}});x();break;case b.ERROR:e.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");k.dispatchEvent(c.CHATEASE_ERROR,{message:"Chat room error!",channel:{id:a.channel}});break;default:k.dispatchEvent(c.CHATEASE_ERROR,{message:"Unknown model state!",state:d.state})}});a.addEventListener(c.CHATEASE_VIEW_SHIELDMSG,
function(a){v(a)});e.addEventListener(c.CHATEASE_READY,function(c){q||(v(c),q=!0,d(),window.onbeforeunload=function(d){l&&a.state==b.CONNECTED&&l.close()})});e.addEventListener(c.CHATEASE_VIEW_SEND,function(b){b.data.text=g.trim(a.maxlength?b.data.text.substr(0,a.maxlength):b.data.text);b.data.text?k.send({cmd:"message",text:b.data.text,type:b.data.type,channel:{id:b.data.channel}}):e.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});e.addEventListener(c.CHATEASE_VIEW_SHIELDMSG,function(b){a.setMsgShield(b.shield)});
e.addEventListener(c.CHATEASE_VIEW_CLEARSCREEN,function(a){e.render.clearScreen();v(a)});e.addEventListener(c.CHATEASE_VIEW_NICKCLICK,function(a){v(a)});e.addEventListener(c.CHATEASE_SETUP_ERROR,function(a){v(a)});e.addEventListener(c.CHATEASE_RENDER_ERROR,function(a){v(a)})}})(chatease);
(function(f){var g=f.utils,c=f.events,b=f.embed=function(a){function e(a){switch(a.type){case c.ERROR:case c.CHATEASE_SETUP_ERROR:case c.CHATEASE_RENDER_ERROR:case c.CHATEASE_ERROR:d.errorScreen(a.message);d.dispatchEvent(c.ERROR,a);break;default:d.dispatchEvent(a.type,a)}}var d=g.extend(this,new c.eventdispatcher("embed")),n={},m=!1,u=null;d.embed=function(){try{n=new b.config(a.config),u=new b.embedder(a,n)}catch(f){g.log("Failed to init embedder!");d.dispatchEvent(c.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",
render:n.render.name});return}u.addGlobalListener(e);u.embed()};d.errorScreen=function(a){m||(m=!0,f.api.displayError(a,n))};(function(){g.foreach(a.config.events,function(b,d){var c=a[b];"function"===g.typeOf(c)&&c.call(a,d)})})()}})(chatease);
(function(f){var g=f.utils,c=f.embed,b=f.core.renders.modes,a=f.core.renders.skins.modes;c.config=function(c){c=g.extend({},{url:"ws://"+window.location.host+"/websocket/websck",width:300,height:450,channel:1,maxlength:30,maxRetries:0,retryDelay:3E3,render:{name:b.DEFAULT,skin:{name:a.DEFAULT}},keywords:"",maxRecords:50},c);switch(g.typeOf(c.channel)){case "array":break;case "number":c.channel=[c.channel];break;case "string":c.channel=c.channel.split(",");break;default:c.channel=[1]}return c};c.config.addConfig=
function(a,b){return g.extend(a,b)}})(chatease);(function(f){var g=f.utils,c=f.events,b=f.core;f.embed.embedder=function(a,e){function d(a){f.dispatchEvent(a.type,a)}var f=g.extend(this,new c.eventdispatcher("embed.embedder"));f.embed=function(){var c=new b.entity(e);c.addGlobalListener(d);c.setup();a.setEntity(c,e.render.name)}}})(chatease);